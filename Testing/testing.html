<!--DOCTYPE html-->
<html>

<head>
    <meta charset="utf-8">
    <title>Our superheroes</title>
    <link href="https://fonts.googleapis.com/css?family=Faster+One" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="jquery-3.3.1.min.js"></script>
</head>

<body>
    <h1>Calendar</h1>
    <table id='calendar'>
        <tr>
        </tr>
    </table>
    <h1>Current</h1>
    <table>
        <tr id='current'>
        </tr>
    </table>
    <h1>Forecast</h1>
    <table>
        <tr id="day0">
            <td>
            </td>
        </tr>
        <tr id="day1">
            <td>
            </td>
        </tr>
        <tr id="day2">
            <td>
            </td>
        </tr>
        <tr id="day3">
            <td>
            </td>
        </tr>
        <tr id="day4">
            <td>
            </td>
        </tr>
    </table>
    <script>
        // var images = ['https://source.unsplash.com/collection/327760/1920x1080', 'https://source.unsplash.com/collection/212915/1920x1080', 'https://source.unsplash.com/collection/158642/1920x1080'];
        // var index = 0;
        // var $top = $('#bod');
        // setInterval(function() {
        //     $top.animate({
        //         opacity: 0
        //     }, 500, function() {
        //         $top.css('background-image', 'url(' + images[++index] + ')');
        //         $top.animate({
        //             opacity: 1
        //         }, 500, function() {
        //             if (index === images.length) index = 0;
        //         });
        //     });
        // }, 6000);

        function loadWeather() {
            var currentWeather_URL = 'http://dataservice.accuweather.com/currentconditions/v1/332270?apikey=mejpRASNhUtuqTRSpDsOS5yJTG3M728t';
            var CurrentWeather_REQUEST = new XMLHttpRequest();
            CurrentWeather_REQUEST.open('GET', currentWeather_URL);
            CurrentWeather_REQUEST.responseType = 'json';
            CurrentWeather_REQUEST.send();
            CurrentWeather_REQUEST.onload = function() {
                var current = CurrentWeather_REQUEST.response;
                populateCurrent(current);
            }
            var forecast_URL = 'http://dataservice.accuweather.com/forecasts/v1/daily/5day/332270?apikey=mejpRASNhUtuqTRSpDsOS5yJTG3M728t';
            var Forecast_REQUEST = new XMLHttpRequest();
            Forecast_REQUEST.open('GET', forecast_URL);
            Forecast_REQUEST.responseType = 'json';
            Forecast_REQUEST.send();
            Forecast_REQUEST.onload = function() {
                var accuweather = Forecast_REQUEST.response;
                populateForecast(accuweather);
            }

        function populateForecast(jsonObj) {
            var forecasts = jsonObj['DailyForecasts']
            for (i = 0; i < 5; i++) {
                document.getElementById('day' + i).childNodes[0].textContent = forecasts[i]['Date'];
                document.getElementById('day' + i).childNodes[1].textContent = forecasts[i]['Temperature']['Minimum']['Value'];
                document.getElementById('day' + i).childNodes[2].textContent = forecasts[i]['Temperature']['Maximum']['Value'];
            }
        }

        function populateCurrent(jsonObj) {
            var currentWeather = jsonObj[0]
            for (i = 0; i < 5; i++) {
                document.getElementById('current').childNodes[0].textContent = currentWeather['Temperature']['Imperial']['Value'];
                document.getElementById('current').childNodes[1].textContent = currentWeather['WeatherText'];
                document.getElementById('current').childNodes[2].textContent = currentWeathe['Temperature']['Maximum']['Value'];
            }
        }
    }
    function loadCalendar() {
      var calendar_URL = 'https://ical-to-json.herokuapp.com/convert.json?url=https%3A%2F%2Fcalendar.google.com%2Fcalendar%2Fical%2Femannguitar%2540gmail.com%2Fprivate-929c0c0e2b253bf5e035f80be76cc3d6%2Fbasic.ics';
      var Calendar_REQUEST = new XMLHttpRequest();
      Calendar_REQUEST.open('GET', calendar_URL);
      Calendar_REQUEST.responseType = 'text';
      Calendar_REQUEST.send();
      Calendar_REQUEST.onload = function() {
          var calendarText = Calendar_REQUEST.response;
          var calendar = JSON.parse(calendarText);
          populateCalendar(calendar);
      }
      function populateCalendar(jsonObj) {
          var table = document.getElementById("calendar");
          var events = jsonObj['vcalendar'][0]['vevent'];
          var time = Math.round((new Date()).getTime() / 1000);
          var today = time - time % 86400 - 18000;
          var tomorrow = today + 86400;
          function inDate(i, day) {
            var year = parseInt(events[i]['dtstart'].substring(0,4),10);
            var month = parseInt(events[i]['dtstart'].substring(4,6),10);
            var day = parseInt(events[i]['dtstart'].substring(6,8),10);
            var epoch_ms = new Date(year, month-1, day).getTime();
            var epoch = epoch_ms/1000;
            return ((epoch >= today) && (epoch < (tomorrow + 86400*day)));
          }
          var eventIndex = 0;
          var day;
          for(day = 0; day < 6; day++) {
            while(inDate(eventIndex, day)) {
              var row = table.insertRow(-1);
              row.textContent = events[eventIndex]['dtstart'];
              eventIndex++;
            }
          }
      }
    }
        //loadWeather();
        setInterval(loadWeather(), 1800000);
        setInterval(loadCalendar(), 1800000);
    </script>
</body>

</html>
